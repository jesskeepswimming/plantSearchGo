{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport * as React from 'react';\n\nvar isEqual = require('deep-equal');\n\nimport diff from './util/diff';\nvar eventToHandler = {\n  touchstart: 'onTouchStart',\n  touchend: 'onTouchEnd',\n  touchcancel: 'onTouchCancel',\n  mousemove: 'onMouseMove',\n  mouseenter: 'onMouseEnter',\n  mouseleave: 'onMouseLeave',\n  mousedown: 'onMouseDown',\n  mouseup: 'onMouseUp',\n  click: 'onClick'\n};\n\nvar Layer = function (_super) {\n  __extends(Layer, _super);\n\n  function Layer() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.source = __assign({\n      type: 'geojson'\n    }, _this.props.geoJSONSourceOptions, {\n      data: {\n        type: 'FeatureCollection',\n        features: []\n      }\n    });\n\n    _this.geometry = function (coordinates) {\n      switch (_this.props.type) {\n        case 'symbol':\n        case 'circle':\n          return {\n            type: 'Point',\n            coordinates: coordinates\n          };\n\n        case 'fill':\n          if (Array.isArray(coordinates[0][0][0])) {\n            return {\n              type: 'MultiPolygon',\n              coordinates: coordinates\n            };\n          }\n\n          return {\n            type: 'Polygon',\n            coordinates: coordinates\n          };\n\n        case 'line':\n          return {\n            type: 'LineString',\n            coordinates: coordinates\n          };\n\n        default:\n          return {\n            type: 'Point',\n            coordinates: coordinates\n          };\n      }\n    };\n\n    _this.makeFeature = function (props, id) {\n      return {\n        type: 'Feature',\n        geometry: _this.geometry(props.coordinates),\n        properties: __assign({}, props.properties, {\n          id: id\n        })\n      };\n    };\n\n    _this.initialize = function () {\n      var _a = _this.props,\n          type = _a.type,\n          layout = _a.layout,\n          paint = _a.paint,\n          sourceId = _a.sourceId,\n          before = _a.before,\n          images = _a.images,\n          id = _a.id,\n          metadata = _a.metadata,\n          sourceLayer = _a.sourceLayer,\n          minZoom = _a.minZoom,\n          maxZoom = _a.maxZoom,\n          filter = _a.filter;\n      var map = _this.props.map;\n      var layer = {\n        id: id,\n        source: sourceId || id,\n        type: type,\n        layout: layout,\n        paint: paint,\n        metadata: metadata\n      };\n\n      if (sourceLayer) {\n        layer['source-layer'] = sourceLayer;\n      }\n\n      if (minZoom) {\n        layer.minzoom = minZoom;\n      }\n\n      if (maxZoom) {\n        layer.maxzoom = maxZoom;\n      }\n\n      if (filter) {\n        layer.filter = filter;\n      }\n\n      if (images) {\n        var normalizedImages = !Array.isArray(images[0]) ? [images] : images;\n        normalizedImages.filter(function (image) {\n          return !map.hasImage(image[0]);\n        }).forEach(function (image) {\n          map.addImage(image[0], image[1], image[2]);\n        });\n      }\n\n      if (!sourceId && !map.getSource(id)) {\n        map.addSource(id, _this.source);\n      }\n\n      if (!map.getLayer(id)) {\n        map.addLayer(layer, before);\n      }\n\n      Object.entries(eventToHandler).forEach(function (_a) {\n        var event = _a[0],\n            propName = _a[1];\n        var handler = _this.props[propName];\n\n        if (handler) {\n          map.on(event, id, handler);\n        }\n      });\n    };\n\n    _this.onStyleDataChange = function () {\n      if (!_this.props.map.getLayer(_this.props.id)) {\n        _this.initialize();\n\n        _this.forceUpdate();\n      }\n    };\n\n    _this.getChildren = function () {\n      var children = _this.props.children;\n\n      if (!children) {\n        return [];\n      }\n\n      if (Array.isArray(children)) {\n        return children.reduce(function (arr, next) {\n          return arr.concat(next);\n        }, []);\n      }\n\n      return [children];\n    };\n\n    return _this;\n  }\n\n  Layer.prototype.componentDidMount = function () {\n    var map = this.props.map;\n    this.initialize();\n    map.on('styledata', this.onStyleDataChange);\n  };\n\n  Layer.prototype.componentWillUnmount = function () {\n    var _this = this;\n\n    var map = this.props.map;\n    var _a = this.props,\n        images = _a.images,\n        id = _a.id;\n\n    if (!map || !map.getStyle()) {\n      return;\n    }\n\n    map.off('styledata', this.onStyleDataChange);\n    Object.entries(eventToHandler).forEach(function (_a) {\n      var event = _a[0],\n          propName = _a[1];\n      var handler = _this.props[propName];\n\n      if (handler) {\n        map.off(event, id, handler);\n      }\n    });\n\n    if (map.getLayer(id)) {\n      map.removeLayer(id);\n    }\n\n    if (!this.props.sourceId) {\n      map.removeSource(id);\n    }\n\n    if (images) {\n      var normalizedImages = !Array.isArray(images[0]) ? [images] : images;\n      normalizedImages.map(function (_a) {\n        var key = _a[0],\n            rest = _a.slice(1);\n\n        return key;\n      }).forEach(map.removeImage.bind(map));\n    }\n  };\n\n  Layer.prototype.componentDidUpdate = function (prevProps) {\n    var _this = this;\n\n    var paint = prevProps.paint,\n        layout = prevProps.layout,\n        before = prevProps.before,\n        filter = prevProps.filter,\n        id = prevProps.id,\n        minZoom = prevProps.minZoom,\n        maxZoom = prevProps.maxZoom,\n        map = prevProps.map;\n\n    if (!isEqual(this.props.paint, paint)) {\n      var paintDiff_1 = diff(paint, this.props.paint);\n      Object.keys(paintDiff_1).forEach(function (key) {\n        map.setPaintProperty(id, key, paintDiff_1[key]);\n      });\n    }\n\n    if (!isEqual(this.props.layout, layout)) {\n      var layoutDiff_1 = diff(layout, this.props.layout);\n      Object.keys(layoutDiff_1).forEach(function (key) {\n        map.setLayoutProperty(id, key, layoutDiff_1[key]);\n      });\n    }\n\n    if (!isEqual(this.props.filter, filter)) {\n      map.setFilter(id, this.props.filter);\n    }\n\n    if (before !== this.props.before) {\n      map.moveLayer(id, this.props.before);\n    }\n\n    if (minZoom !== this.props.minZoom || maxZoom !== this.props.maxZoom) {\n      map.setLayerZoomRange(id, this.props.minZoom, this.props.maxZoom);\n    }\n\n    Object.entries(eventToHandler).forEach(function (_a) {\n      var event = _a[0],\n          propName = _a[1];\n      var oldHandler = prevProps[propName];\n      var newHandler = _this.props[propName];\n\n      if (oldHandler !== newHandler) {\n        if (oldHandler) {\n          map.off(event, id, oldHandler);\n        }\n\n        if (newHandler) {\n          map.on(event, id, newHandler);\n        }\n      }\n    });\n  };\n\n  Layer.prototype.render = function () {\n    var _this = this;\n\n    var map = this.props.map;\n    var _a = this.props,\n        sourceId = _a.sourceId,\n        draggedChildren = _a.draggedChildren;\n    var children = this.getChildren();\n\n    if (draggedChildren) {\n      var draggableChildrenIds_1 = draggedChildren.map(function (child) {\n        return child.key;\n      });\n      children = children.map(function (child) {\n        var indexChildren = draggableChildrenIds_1.indexOf(child.key);\n\n        if (indexChildren !== -1) {\n          return draggedChildren[indexChildren];\n        }\n\n        return child;\n      });\n    }\n\n    var features = children.map(function (_a, id) {\n      var props = _a.props;\n      return _this.makeFeature(props, id);\n    }).filter(Boolean);\n    var source = map.getSource(sourceId || this.props.id);\n\n    if (source && !sourceId && source.setData) {\n      source.setData({\n        type: 'FeatureCollection',\n        features: features\n      });\n    }\n\n    return null;\n  };\n\n  Layer.defaultProps = {\n    type: 'symbol',\n    layout: {},\n    paint: {}\n  };\n  return Layer;\n}(React.Component);\n\nexport default Layer;","map":{"version":3,"sources":["../src/layer.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport * as React from 'react';\nvar isEqual = require('deep-equal');\nimport diff from './util/diff';\nvar eventToHandler = {\n    touchstart: 'onTouchStart',\n    touchend: 'onTouchEnd',\n    touchcancel: 'onTouchCancel',\n    mousemove: 'onMouseMove',\n    mouseenter: 'onMouseEnter',\n    mouseleave: 'onMouseLeave',\n    mousedown: 'onMouseDown',\n    mouseup: 'onMouseUp',\n    click: 'onClick'\n};\nvar Layer = (function (_super) {\n    __extends(Layer, _super);\n    function Layer() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.source = __assign({ type: 'geojson' }, _this.props.geoJSONSourceOptions, { data: {\n                type: 'FeatureCollection',\n                features: []\n            } });\n        _this.geometry = function (coordinates) {\n            switch (_this.props.type) {\n                case 'symbol':\n                case 'circle':\n                    return {\n                        type: 'Point',\n                        coordinates: coordinates\n                    };\n                case 'fill':\n                    if (Array.isArray(coordinates[0][0][0])) {\n                        return {\n                            type: 'MultiPolygon',\n                            coordinates: coordinates\n                        };\n                    }\n                    return {\n                        type: 'Polygon',\n                        coordinates: coordinates\n                    };\n                case 'line':\n                    return {\n                        type: 'LineString',\n                        coordinates: coordinates\n                    };\n                default:\n                    return {\n                        type: 'Point',\n                        coordinates: coordinates\n                    };\n            }\n        };\n        _this.makeFeature = function (props, id) { return ({\n            type: 'Feature',\n            geometry: _this.geometry(props.coordinates),\n            properties: __assign({}, props.properties, { id: id })\n        }); };\n        _this.initialize = function () {\n            var _a = _this.props, type = _a.type, layout = _a.layout, paint = _a.paint, sourceId = _a.sourceId, before = _a.before, images = _a.images, id = _a.id, metadata = _a.metadata, sourceLayer = _a.sourceLayer, minZoom = _a.minZoom, maxZoom = _a.maxZoom, filter = _a.filter;\n            var map = _this.props.map;\n            var layer = {\n                id: id,\n                source: sourceId || id,\n                type: type,\n                layout: layout,\n                paint: paint,\n                metadata: metadata\n            };\n            if (sourceLayer) {\n                layer['source-layer'] = sourceLayer;\n            }\n            if (minZoom) {\n                layer.minzoom = minZoom;\n            }\n            if (maxZoom) {\n                layer.maxzoom = maxZoom;\n            }\n            if (filter) {\n                layer.filter = filter;\n            }\n            if (images) {\n                var normalizedImages = !Array.isArray(images[0]) ? [images] : images;\n                normalizedImages\n                    .filter(function (image) { return !map.hasImage(image[0]); })\n                    .forEach(function (image) {\n                    map.addImage(image[0], image[1], image[2]);\n                });\n            }\n            if (!sourceId && !map.getSource(id)) {\n                map.addSource(id, _this.source);\n            }\n            if (!map.getLayer(id)) {\n                map.addLayer(layer, before);\n            }\n            Object.entries(eventToHandler).forEach(function (_a) {\n                var event = _a[0], propName = _a[1];\n                var handler = _this.props[propName];\n                if (handler) {\n                    map.on(event, id, handler);\n                }\n            });\n        };\n        _this.onStyleDataChange = function () {\n            if (!_this.props.map.getLayer(_this.props.id)) {\n                _this.initialize();\n                _this.forceUpdate();\n            }\n        };\n        _this.getChildren = function () {\n            var children = _this.props.children;\n            if (!children) {\n                return [];\n            }\n            if (Array.isArray(children)) {\n                return children.reduce(function (arr, next) { return arr.concat(next); }, []);\n            }\n            return [children];\n        };\n        return _this;\n    }\n    Layer.prototype.componentDidMount = function () {\n        var map = this.props.map;\n        this.initialize();\n        map.on('styledata', this.onStyleDataChange);\n    };\n    Layer.prototype.componentWillUnmount = function () {\n        var _this = this;\n        var map = this.props.map;\n        var _a = this.props, images = _a.images, id = _a.id;\n        if (!map || !map.getStyle()) {\n            return;\n        }\n        map.off('styledata', this.onStyleDataChange);\n        Object.entries(eventToHandler).forEach(function (_a) {\n            var event = _a[0], propName = _a[1];\n            var handler = _this.props[propName];\n            if (handler) {\n                map.off(event, id, handler);\n            }\n        });\n        if (map.getLayer(id)) {\n            map.removeLayer(id);\n        }\n        if (!this.props.sourceId) {\n            map.removeSource(id);\n        }\n        if (images) {\n            var normalizedImages = !Array.isArray(images[0]) ? [images] : images;\n            normalizedImages\n                .map(function (_a) {\n                var key = _a[0], rest = _a.slice(1);\n                return key;\n            })\n                .forEach(map.removeImage.bind(map));\n        }\n    };\n    Layer.prototype.componentDidUpdate = function (prevProps) {\n        var _this = this;\n        var paint = prevProps.paint, layout = prevProps.layout, before = prevProps.before, filter = prevProps.filter, id = prevProps.id, minZoom = prevProps.minZoom, maxZoom = prevProps.maxZoom, map = prevProps.map;\n        if (!isEqual(this.props.paint, paint)) {\n            var paintDiff_1 = diff(paint, this.props.paint);\n            Object.keys(paintDiff_1).forEach(function (key) {\n                map.setPaintProperty(id, key, paintDiff_1[key]);\n            });\n        }\n        if (!isEqual(this.props.layout, layout)) {\n            var layoutDiff_1 = diff(layout, this.props.layout);\n            Object.keys(layoutDiff_1).forEach(function (key) {\n                map.setLayoutProperty(id, key, layoutDiff_1[key]);\n            });\n        }\n        if (!isEqual(this.props.filter, filter)) {\n            map.setFilter(id, this.props.filter);\n        }\n        if (before !== this.props.before) {\n            map.moveLayer(id, this.props.before);\n        }\n        if (minZoom !== this.props.minZoom || maxZoom !== this.props.maxZoom) {\n            map.setLayerZoomRange(id, this.props.minZoom, this.props.maxZoom);\n        }\n        Object.entries(eventToHandler).forEach(function (_a) {\n            var event = _a[0], propName = _a[1];\n            var oldHandler = prevProps[propName];\n            var newHandler = _this.props[propName];\n            if (oldHandler !== newHandler) {\n                if (oldHandler) {\n                    map.off(event, id, oldHandler);\n                }\n                if (newHandler) {\n                    map.on(event, id, newHandler);\n                }\n            }\n        });\n    };\n    Layer.prototype.render = function () {\n        var _this = this;\n        var map = this.props.map;\n        var _a = this.props, sourceId = _a.sourceId, draggedChildren = _a.draggedChildren;\n        var children = this.getChildren();\n        if (draggedChildren) {\n            var draggableChildrenIds_1 = draggedChildren.map(function (child) { return child.key; });\n            children = children.map(function (child) {\n                var indexChildren = draggableChildrenIds_1.indexOf(child.key);\n                if (indexChildren !== -1) {\n                    return draggedChildren[indexChildren];\n                }\n                return child;\n            });\n        }\n        var features = children\n            .map(function (_a, id) {\n            var props = _a.props;\n            return _this.makeFeature(props, id);\n        })\n            .filter(Boolean);\n        var source = map.getSource(sourceId || this.props.id);\n        if (source && !sourceId && source.setData) {\n            source.setData({\n                type: 'FeatureCollection',\n                features: features\n            });\n        }\n        return null;\n    };\n    Layer.defaultProps = {\n        type: 'symbol',\n        layout: {},\n        paint: {}\n    };\n    return Layer;\n}(React.Component));\nexport default Layer;\n//# sourceMappingURL=layer.js.map"]},"metadata":{},"sourceType":"module"}