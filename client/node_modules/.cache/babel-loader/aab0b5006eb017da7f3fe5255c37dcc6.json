{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport * as React from 'react';\nimport { generateID } from './util/uid';\nexport function layerMouseTouchEvents(WrappedComponent) {\n  return function (_super) {\n    __extends(EnhancedLayer, _super);\n\n    function EnhancedLayer() {\n      var _this = _super !== null && _super.apply(this, arguments) || this;\n\n      _this.hover = [];\n      _this.draggedChildren = undefined;\n      _this.id = _this.props.id || \"layer-\" + generateID();\n\n      _this.getChildren = function () {\n        return [].concat(_this.props.children).filter(function (el) {\n          return typeof el !== 'undefined';\n        });\n      };\n\n      _this.getChildFromId = function (children, id) {\n        return children[id];\n      };\n\n      _this.areFeaturesDraggable = function (children, featureIds) {\n        if (featureIds === void 0) {\n          featureIds = _this.hover;\n        }\n\n        return !!featureIds.map(function (id) {\n          return _this.getChildFromId(children, id) ? _this.getChildFromId(children, id).props.draggable : false;\n        }).filter(Boolean).length;\n      };\n\n      _this.onClick = function (evt) {\n        var features = evt.features;\n\n        var children = _this.getChildren();\n\n        var map = _this.props.map;\n\n        if (features) {\n          features.forEach(function (feature) {\n            var id = feature.properties.id;\n\n            if (children) {\n              var child = _this.getChildFromId(children, id);\n\n              var onClick = child && child.props.onClick;\n\n              if (onClick) {\n                onClick(__assign({}, evt, {\n                  feature: feature,\n                  map: map\n                }));\n              }\n            }\n          });\n        }\n      };\n\n      _this.onMouseEnter = function (evt) {\n        var children = _this.getChildren();\n\n        var map = _this.props.map;\n        _this.hover = [];\n        evt.features.forEach(function (feature) {\n          var id = feature.properties.id;\n\n          var child = _this.getChildFromId(children, id);\n\n          _this.hover.push(id);\n\n          var onMouseEnter = child && child.props.onMouseEnter;\n\n          if (onMouseEnter) {\n            onMouseEnter(__assign({}, evt, {\n              feature: feature,\n              map: map\n            }));\n          }\n        });\n\n        if (_this.areFeaturesDraggable(children)) {\n          map.dragPan.disable();\n        }\n      };\n\n      _this.onMouseLeave = function (evt) {\n        var children = _this.getChildren();\n\n        var map = _this.props.map;\n\n        if (_this.areFeaturesDraggable(children)) {\n          map.dragPan.enable();\n        }\n\n        _this.hover.forEach(function (id) {\n          var child = _this.getChildFromId(children, id);\n\n          var onMouseLeave = child && child.props.onMouseLeave;\n\n          if (onMouseLeave) {\n            onMouseLeave(__assign({}, evt, {\n              map: map\n            }));\n          }\n        });\n\n        if (!_this.draggedChildren) {\n          _this.hover = [];\n        }\n      };\n\n      _this.onMouseDown = function () {\n        if (_this.hover.length) {\n          _this.onFeatureDown('mousedown');\n        }\n      };\n\n      _this.onTouchStart = function (evt) {\n        _this.hover = evt.features.map(function (feature) {\n          return feature.properties.id;\n        });\n\n        if (_this.hover.length) {\n          _this.onFeatureDown('touchstart');\n        }\n      };\n\n      _this.onFeatureDown = function (startEvent) {\n        var moveEvent = startEvent === 'mousedown' ? 'mousemove' : 'touchmove';\n        var endEvent = startEvent === 'mousedown' ? 'mouseup' : 'touchend';\n        var map = _this.props.map;\n        map.once(moveEvent, _this.onFeatureDragStart);\n        map.on(moveEvent, _this.onFeatureDrag);\n        map.once(endEvent, function (evt) {\n          map.off(moveEvent, _this.onFeatureDragStart);\n          map.off(moveEvent, _this.onFeatureDrag);\n\n          _this.onFeatureDragEnd(evt);\n        });\n      };\n\n      _this.onFeatureDragStart = function (evt) {\n        var map = _this.props.map;\n\n        var children = _this.getChildren();\n\n        _this.hover.forEach(function (id) {\n          var child = _this.getChildFromId(children, id);\n\n          if (child && !child.props.draggable) {\n            return;\n          }\n\n          var onDragStart = child && child.props.onDragStart;\n\n          if (onDragStart) {\n            onDragStart(__assign({}, evt, {\n              map: map\n            }));\n          }\n        });\n      };\n\n      _this.onFeatureDrag = function (evt) {\n        var children = _this.getChildren();\n\n        var map = _this.props.map;\n        var _a = evt.lngLat,\n            lng = _a.lng,\n            lat = _a.lat;\n        _this.draggedChildren = [];\n\n        _this.hover.forEach(function (id) {\n          var child = _this.getChildFromId(children, id);\n\n          var onDrag = child && child.props.onDrag;\n\n          if (child && child.props.draggable) {\n            _this.draggedChildren.push(React.cloneElement(child, {\n              coordinates: [lng, lat]\n            }));\n\n            if (onDrag) {\n              onDrag(__assign({}, evt, {\n                map: map\n              }));\n            }\n          }\n        });\n\n        _this.forceUpdate();\n      };\n\n      _this.onFeatureDragEnd = function (evt) {\n        var map = _this.props.map;\n\n        var children = _this.getChildren();\n\n        _this.hover.forEach(function (id) {\n          var child = _this.getChildFromId(children, id);\n\n          var onDragEnd = child && child.props.onDragEnd;\n\n          if (onDragEnd && child.props.draggable && _this.draggedChildren) {\n            onDragEnd(__assign({}, evt, {\n              map: map\n            }));\n          }\n        });\n\n        _this.draggedChildren = undefined;\n      };\n\n      return _this;\n    }\n\n    EnhancedLayer.prototype.componentDidMount = function () {\n      var map = this.props.map;\n      map.on('click', this.id, this.onClick);\n      map.on('mouseenter', this.id, this.onMouseEnter);\n      map.on('mouseleave', this.id, this.onMouseLeave);\n      map.on('mousedown', this.id, this.onMouseDown);\n      map.on('touchstart', this.id, this.onTouchStart);\n    };\n\n    EnhancedLayer.prototype.componentWillUnmount = function () {\n      var map = this.props.map;\n      map.off('click', this.onClick);\n      map.off('mouseenter', this.onMouseEnter);\n      map.off('mouseleave', this.onMouseLeave);\n      map.off('mousedown', this.onMouseDown);\n      map.off('touchstart', this.onTouchStart);\n    };\n\n    EnhancedLayer.prototype.render = function () {\n      return React.createElement(WrappedComponent, __assign({}, this.props, {\n        id: this.id,\n        map: this.props.map,\n        draggedChildren: this.draggedChildren\n      }));\n    };\n\n    return EnhancedLayer;\n  }(React.Component);\n}\nexport default layerMouseTouchEvents;","map":{"version":3,"sources":["../src/layer-events-hoc.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport * as React from 'react';\nimport { generateID } from './util/uid';\nexport function layerMouseTouchEvents(WrappedComponent) {\n    return (function (_super) {\n        __extends(EnhancedLayer, _super);\n        function EnhancedLayer() {\n            var _this = _super !== null && _super.apply(this, arguments) || this;\n            _this.hover = [];\n            _this.draggedChildren = undefined;\n            _this.id = _this.props.id || \"layer-\" + generateID();\n            _this.getChildren = function () {\n                return []\n                    .concat(_this.props.children)\n                    .filter(function (el) {\n                    return typeof el !== 'undefined';\n                });\n            };\n            _this.getChildFromId = function (children, id) { return children[id]; };\n            _this.areFeaturesDraggable = function (children, featureIds) {\n                if (featureIds === void 0) { featureIds = _this.hover; }\n                return !!featureIds\n                    .map(function (id) {\n                    return _this.getChildFromId(children, id)\n                        ? _this.getChildFromId(children, id).props.draggable\n                        : false;\n                })\n                    .filter(Boolean).length;\n            };\n            _this.onClick = function (evt) {\n                var features = evt.features;\n                var children = _this.getChildren();\n                var map = _this.props.map;\n                if (features) {\n                    features.forEach(function (feature) {\n                        var id = feature.properties.id;\n                        if (children) {\n                            var child = _this.getChildFromId(children, id);\n                            var onClick = child && child.props.onClick;\n                            if (onClick) {\n                                onClick(__assign({}, evt, { feature: feature, map: map }));\n                            }\n                        }\n                    });\n                }\n            };\n            _this.onMouseEnter = function (evt) {\n                var children = _this.getChildren();\n                var map = _this.props.map;\n                _this.hover = [];\n                evt.features.forEach(function (feature) {\n                    var id = feature.properties.id;\n                    var child = _this.getChildFromId(children, id);\n                    _this.hover.push(id);\n                    var onMouseEnter = child && child.props.onMouseEnter;\n                    if (onMouseEnter) {\n                        onMouseEnter(__assign({}, evt, { feature: feature, map: map }));\n                    }\n                });\n                if (_this.areFeaturesDraggable(children)) {\n                    map.dragPan.disable();\n                }\n            };\n            _this.onMouseLeave = function (evt) {\n                var children = _this.getChildren();\n                var map = _this.props.map;\n                if (_this.areFeaturesDraggable(children)) {\n                    map.dragPan.enable();\n                }\n                _this.hover.forEach(function (id) {\n                    var child = _this.getChildFromId(children, id);\n                    var onMouseLeave = child && child.props.onMouseLeave;\n                    if (onMouseLeave) {\n                        onMouseLeave(__assign({}, evt, { map: map }));\n                    }\n                });\n                if (!_this.draggedChildren) {\n                    _this.hover = [];\n                }\n            };\n            _this.onMouseDown = function () {\n                if (_this.hover.length) {\n                    _this.onFeatureDown('mousedown');\n                }\n            };\n            _this.onTouchStart = function (evt) {\n                _this.hover = evt.features.map(function (feature) { return feature.properties.id; });\n                if (_this.hover.length) {\n                    _this.onFeatureDown('touchstart');\n                }\n            };\n            _this.onFeatureDown = function (startEvent) {\n                var moveEvent = startEvent === 'mousedown' ? 'mousemove' : 'touchmove';\n                var endEvent = startEvent === 'mousedown' ? 'mouseup' : 'touchend';\n                var map = _this.props.map;\n                map.once(moveEvent, _this.onFeatureDragStart);\n                map.on(moveEvent, _this.onFeatureDrag);\n                map.once(endEvent, function (evt) {\n                    map.off(moveEvent, _this.onFeatureDragStart);\n                    map.off(moveEvent, _this.onFeatureDrag);\n                    _this.onFeatureDragEnd(evt);\n                });\n            };\n            _this.onFeatureDragStart = function (evt) {\n                var map = _this.props.map;\n                var children = _this.getChildren();\n                _this.hover.forEach(function (id) {\n                    var child = _this.getChildFromId(children, id);\n                    if (child && !child.props.draggable) {\n                        return;\n                    }\n                    var onDragStart = child && child.props.onDragStart;\n                    if (onDragStart) {\n                        onDragStart(__assign({}, evt, { map: map }));\n                    }\n                });\n            };\n            _this.onFeatureDrag = function (evt) {\n                var children = _this.getChildren();\n                var map = _this.props.map;\n                var _a = evt.lngLat, lng = _a.lng, lat = _a.lat;\n                _this.draggedChildren = [];\n                _this.hover.forEach(function (id) {\n                    var child = _this.getChildFromId(children, id);\n                    var onDrag = child && child.props.onDrag;\n                    if (child && child.props.draggable) {\n                        _this.draggedChildren.push(React.cloneElement(child, {\n                            coordinates: [lng, lat]\n                        }));\n                        if (onDrag) {\n                            onDrag(__assign({}, evt, { map: map }));\n                        }\n                    }\n                });\n                _this.forceUpdate();\n            };\n            _this.onFeatureDragEnd = function (evt) {\n                var map = _this.props.map;\n                var children = _this.getChildren();\n                _this.hover.forEach(function (id) {\n                    var child = _this.getChildFromId(children, id);\n                    var onDragEnd = child && child.props.onDragEnd;\n                    if (onDragEnd && child.props.draggable && _this.draggedChildren) {\n                        onDragEnd(__assign({}, evt, { map: map }));\n                    }\n                });\n                _this.draggedChildren = undefined;\n            };\n            return _this;\n        }\n        EnhancedLayer.prototype.componentDidMount = function () {\n            var map = this.props.map;\n            map.on('click', this.id, this.onClick);\n            map.on('mouseenter', this.id, this.onMouseEnter);\n            map.on('mouseleave', this.id, this.onMouseLeave);\n            map.on('mousedown', this.id, this.onMouseDown);\n            map.on('touchstart', this.id, this.onTouchStart);\n        };\n        EnhancedLayer.prototype.componentWillUnmount = function () {\n            var map = this.props.map;\n            map.off('click', this.onClick);\n            map.off('mouseenter', this.onMouseEnter);\n            map.off('mouseleave', this.onMouseLeave);\n            map.off('mousedown', this.onMouseDown);\n            map.off('touchstart', this.onTouchStart);\n        };\n        EnhancedLayer.prototype.render = function () {\n            return (React.createElement(WrappedComponent, __assign({}, this.props, { id: this.id, map: this.props.map, draggedChildren: this.draggedChildren })));\n        };\n        return EnhancedLayer;\n    }(React.Component));\n}\nexport default layerMouseTouchEvents;\n//# sourceMappingURL=layer-events-hoc.js.map"]},"metadata":{},"sourceType":"module"}