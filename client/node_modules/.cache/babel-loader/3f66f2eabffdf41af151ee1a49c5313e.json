{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport * as React from 'react';\n\nvar isEqual = require('deep-equal');\n\nimport diff from './util/diff';\nimport { generateID } from './util/uid';\nimport { withMap } from './context';\nvar types = ['symbol', 'line', 'fill', 'fill-extrusion', 'circle'];\n\nvar toCamelCase = function (str) {\n  return str.replace(/(?:^\\w|[A-Z]|\\b\\w)/g, function (letter, index) {\n    return index === 0 ? letter.toLowerCase() : letter.toUpperCase();\n  }).replace(/[\\s+]|-/g, '');\n};\n\nvar eventToHandler = {\n  mousemove: 'OnMouseMove',\n  mouseenter: 'OnMouseEnter',\n  mouseleave: 'OnMouseLeave',\n  mousedown: 'OnMouseDown',\n  mouseup: 'OnMouseUp',\n  click: 'OnClick'\n};\n\nvar GeoJSONLayer = function (_super) {\n  __extends(GeoJSONLayer, _super);\n\n  function GeoJSONLayer() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.id = _this.props.id || \"geojson-\" + generateID();\n    _this.source = __assign({\n      type: 'geojson'\n    }, _this.props.sourceOptions, {\n      data: _this.props.data\n    });\n    _this.layerIds = [];\n\n    _this.buildLayerId = function (type) {\n      return _this.id + \"-\" + type;\n    };\n\n    _this.createLayer = function (type) {\n      var _a = _this.props,\n          before = _a.before,\n          layerOptions = _a.layerOptions,\n          map = _a.map;\n\n      var layerId = _this.buildLayerId(type);\n\n      _this.layerIds.push(layerId);\n\n      var paint = _this.props[toCamelCase(type) + \"Paint\"] || {};\n      var visibility = Object.keys(paint).length ? 'visible' : 'none';\n      var layout = _this.props[toCamelCase(type) + \"Layout\"] || {\n        visibility: visibility\n      };\n\n      var layer = __assign({\n        id: layerId,\n        source: _this.id,\n        type: type,\n        paint: paint,\n        layout: layout\n      }, layerOptions);\n\n      map.addLayer(layer, before);\n\n      _this.mapLayerMouseHandlers(type);\n    };\n\n    _this.mapLayerMouseHandlers = function (type) {\n      var map = _this.props.map;\n\n      var layerId = _this.buildLayerId(type);\n\n      var events = Object.keys(eventToHandler);\n      events.forEach(function (event) {\n        var handler = _this.props[\"\" + toCamelCase(type) + eventToHandler[event]] || null;\n\n        if (handler) {\n          map.on(event, layerId, handler);\n        }\n      });\n    };\n\n    _this.onStyleDataChange = function () {\n      if (!_this.props.map.getSource(_this.id)) {\n        _this.unbind();\n\n        _this.initialize();\n\n        _this.forceUpdate();\n      }\n    };\n\n    _this.isGeoJSONSource = function (source) {\n      return !!source && typeof source.setData === 'function';\n    };\n\n    return _this;\n  }\n\n  GeoJSONLayer.prototype.initialize = function () {\n    var map = this.props.map;\n    map.addSource(this.id, this.source);\n    this.createLayer('symbol');\n    this.createLayer('line');\n    this.createLayer('fill');\n    this.createLayer('fill-extrusion');\n    this.createLayer('circle');\n  };\n\n  GeoJSONLayer.prototype.unbind = function () {\n    var _this = this;\n\n    var map = this.props.map;\n\n    if (map.getSource(this.id)) {\n      var layers = map.getStyle().layers;\n\n      if (layers) {\n        layers.filter(function (layer) {\n          return layer.source === _this.id;\n        }).forEach(function (layer) {\n          return map.removeLayer(layer.id);\n        });\n      }\n\n      map.removeSource(this.id);\n    }\n\n    types.forEach(function (type) {\n      var events = Object.keys(eventToHandler);\n      events.forEach(function (event) {\n        var prop = toCamelCase(type) + eventToHandler[event];\n\n        if (_this.props[prop]) {\n          map.off(event, _this.buildLayerId(type), _this.props[prop]);\n        }\n      });\n    });\n    this.layerIds.forEach(function (lId) {\n      if (map.getLayer(lId)) {\n        map.removeLayer(lId);\n      }\n    });\n  };\n\n  GeoJSONLayer.prototype.componentDidMount = function () {\n    var map = this.props.map;\n    this.initialize();\n    map.on('styledata', this.onStyleDataChange);\n  };\n\n  GeoJSONLayer.prototype.componentWillUnmount = function () {\n    var map = this.props.map;\n\n    if (!map || !map.getStyle()) {\n      return;\n    }\n\n    map.off('styledata', this.onStyleDataChange);\n    this.unbind();\n  };\n\n  GeoJSONLayer.prototype.componentDidUpdate = function (prevProps) {\n    var _this = this;\n\n    var data = prevProps.data,\n        before = prevProps.before,\n        layerOptions = prevProps.layerOptions,\n        map = prevProps.map;\n    var source = map.getSource(this.id);\n\n    if (!this.isGeoJSONSource(source)) {\n      return;\n    }\n\n    if (this.props.data !== data) {\n      source.setData(this.props.data);\n      this.source = __assign({\n        type: 'geojson'\n      }, this.props.sourceOptions, {\n        data: this.props.data\n      });\n    }\n\n    var layerFilterChanged = this.props.layerOptions && layerOptions && !isEqual(this.props.layerOptions.filter, layerOptions.filter);\n    types.forEach(function (type) {\n      var layerId = _this.buildLayerId(type);\n\n      if (_this.props.layerOptions && layerFilterChanged) {\n        map.setFilter(layerId, _this.props.layerOptions.filter || []);\n      }\n\n      var paintProp = toCamelCase(type) + 'Paint';\n\n      if (!isEqual(prevProps[paintProp], _this.props[paintProp])) {\n        var paintDiff_1 = diff(prevProps[paintProp], _this.props[paintProp]);\n        Object.keys(paintDiff_1).forEach(function (key) {\n          map.setPaintProperty(layerId, key, paintDiff_1[key]);\n        });\n      }\n\n      var layoutProp = toCamelCase(type) + 'Layout';\n\n      if (!isEqual(prevProps[layoutProp], _this.props[layoutProp])) {\n        var layoutDiff_1 = diff(prevProps[layoutProp], _this.props[layoutProp]);\n        Object.keys(layoutDiff_1).forEach(function (key) {\n          map.setLayoutProperty(layerId, key, layoutDiff_1[key]);\n        });\n      }\n\n      var events = Object.keys(eventToHandler);\n      events.forEach(function (event) {\n        var prop = toCamelCase(type) + eventToHandler[event];\n\n        if (prevProps[prop] !== _this.props[prop]) {\n          if (prevProps[prop]) {\n            map.off(event, layerId, prevProps[prop]);\n          }\n\n          if (_this.props[prop]) {\n            map.on(event, layerId, _this.props[prop]);\n          }\n        }\n      });\n\n      if (before !== _this.props.before) {\n        map.moveLayer(layerId, _this.props.before);\n      }\n    });\n  };\n\n  GeoJSONLayer.prototype.render = function () {\n    return null;\n  };\n\n  return GeoJSONLayer;\n}(React.Component);\n\nexport { GeoJSONLayer };\nexport default withMap(GeoJSONLayer);","map":{"version":3,"sources":["../src/geojson-layer.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport * as React from 'react';\nvar isEqual = require('deep-equal');\nimport diff from './util/diff';\nimport { generateID } from './util/uid';\nimport { withMap } from './context';\nvar types = ['symbol', 'line', 'fill', 'fill-extrusion', 'circle'];\nvar toCamelCase = function (str) {\n    return str\n        .replace(/(?:^\\w|[A-Z]|\\b\\w)/g, function (letter, index) {\n        return index === 0 ? letter.toLowerCase() : letter.toUpperCase();\n    })\n        .replace(/[\\s+]|-/g, '');\n};\nvar eventToHandler = {\n    mousemove: 'OnMouseMove',\n    mouseenter: 'OnMouseEnter',\n    mouseleave: 'OnMouseLeave',\n    mousedown: 'OnMouseDown',\n    mouseup: 'OnMouseUp',\n    click: 'OnClick'\n};\nvar GeoJSONLayer = (function (_super) {\n    __extends(GeoJSONLayer, _super);\n    function GeoJSONLayer() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.id = _this.props.id || \"geojson-\" + generateID();\n        _this.source = __assign({ type: 'geojson' }, _this.props.sourceOptions, { data: _this.props.data });\n        _this.layerIds = [];\n        _this.buildLayerId = function (type) {\n            return _this.id + \"-\" + type;\n        };\n        _this.createLayer = function (type) {\n            var _a = _this.props, before = _a.before, layerOptions = _a.layerOptions, map = _a.map;\n            var layerId = _this.buildLayerId(type);\n            _this.layerIds.push(layerId);\n            var paint = _this.props[toCamelCase(type) + \"Paint\"] || {};\n            var visibility = Object.keys(paint).length ? 'visible' : 'none';\n            var layout = _this.props[toCamelCase(type) + \"Layout\"] || {\n                visibility: visibility\n            };\n            var layer = __assign({ id: layerId, source: _this.id, type: type, paint: paint, layout: layout }, layerOptions);\n            map.addLayer(layer, before);\n            _this.mapLayerMouseHandlers(type);\n        };\n        _this.mapLayerMouseHandlers = function (type) {\n            var map = _this.props.map;\n            var layerId = _this.buildLayerId(type);\n            var events = Object.keys(eventToHandler);\n            events.forEach(function (event) {\n                var handler = _this.props[\"\" + toCamelCase(type) + eventToHandler[event]] || null;\n                if (handler) {\n                    map.on(event, layerId, handler);\n                }\n            });\n        };\n        _this.onStyleDataChange = function () {\n            if (!_this.props.map.getSource(_this.id)) {\n                _this.unbind();\n                _this.initialize();\n                _this.forceUpdate();\n            }\n        };\n        _this.isGeoJSONSource = function (source) {\n            return !!source &&\n                typeof source.setData === 'function';\n        };\n        return _this;\n    }\n    GeoJSONLayer.prototype.initialize = function () {\n        var map = this.props.map;\n        map.addSource(this.id, this.source);\n        this.createLayer('symbol');\n        this.createLayer('line');\n        this.createLayer('fill');\n        this.createLayer('fill-extrusion');\n        this.createLayer('circle');\n    };\n    GeoJSONLayer.prototype.unbind = function () {\n        var _this = this;\n        var map = this.props.map;\n        if (map.getSource(this.id)) {\n            var layers = map.getStyle().layers;\n            if (layers) {\n                layers\n                    .filter(function (layer) { return layer.source === _this.id; })\n                    .forEach(function (layer) { return map.removeLayer(layer.id); });\n            }\n            map.removeSource(this.id);\n        }\n        types.forEach(function (type) {\n            var events = Object.keys(eventToHandler);\n            events.forEach(function (event) {\n                var prop = toCamelCase(type) + eventToHandler[event];\n                if (_this.props[prop]) {\n                    map.off(event, _this.buildLayerId(type), _this.props[prop]);\n                }\n            });\n        });\n        this.layerIds.forEach(function (lId) {\n            if (map.getLayer(lId)) {\n                map.removeLayer(lId);\n            }\n        });\n    };\n    GeoJSONLayer.prototype.componentDidMount = function () {\n        var map = this.props.map;\n        this.initialize();\n        map.on('styledata', this.onStyleDataChange);\n    };\n    GeoJSONLayer.prototype.componentWillUnmount = function () {\n        var map = this.props.map;\n        if (!map || !map.getStyle()) {\n            return;\n        }\n        map.off('styledata', this.onStyleDataChange);\n        this.unbind();\n    };\n    GeoJSONLayer.prototype.componentDidUpdate = function (prevProps) {\n        var _this = this;\n        var data = prevProps.data, before = prevProps.before, layerOptions = prevProps.layerOptions, map = prevProps.map;\n        var source = map.getSource(this.id);\n        if (!this.isGeoJSONSource(source)) {\n            return;\n        }\n        if (this.props.data !== data) {\n            source.setData(this.props.data);\n            this.source = __assign({ type: 'geojson' }, this.props.sourceOptions, { data: this.props.data });\n        }\n        var layerFilterChanged = this.props.layerOptions &&\n            layerOptions &&\n            !isEqual(this.props.layerOptions.filter, layerOptions.filter);\n        types.forEach(function (type) {\n            var layerId = _this.buildLayerId(type);\n            if (_this.props.layerOptions && layerFilterChanged) {\n                map.setFilter(layerId, _this.props.layerOptions.filter || []);\n            }\n            var paintProp = toCamelCase(type) + 'Paint';\n            if (!isEqual(prevProps[paintProp], _this.props[paintProp])) {\n                var paintDiff_1 = diff(prevProps[paintProp], _this.props[paintProp]);\n                Object.keys(paintDiff_1).forEach(function (key) {\n                    map.setPaintProperty(layerId, key, paintDiff_1[key]);\n                });\n            }\n            var layoutProp = toCamelCase(type) + 'Layout';\n            if (!isEqual(prevProps[layoutProp], _this.props[layoutProp])) {\n                var layoutDiff_1 = diff(prevProps[layoutProp], _this.props[layoutProp]);\n                Object.keys(layoutDiff_1).forEach(function (key) {\n                    map.setLayoutProperty(layerId, key, layoutDiff_1[key]);\n                });\n            }\n            var events = Object.keys(eventToHandler);\n            events.forEach(function (event) {\n                var prop = toCamelCase(type) + eventToHandler[event];\n                if (prevProps[prop] !== _this.props[prop]) {\n                    if (prevProps[prop]) {\n                        map.off(event, layerId, prevProps[prop]);\n                    }\n                    if (_this.props[prop]) {\n                        map.on(event, layerId, _this.props[prop]);\n                    }\n                }\n            });\n            if (before !== _this.props.before) {\n                map.moveLayer(layerId, _this.props.before);\n            }\n        });\n    };\n    GeoJSONLayer.prototype.render = function () {\n        return null;\n    };\n    return GeoJSONLayer;\n}(React.Component));\nexport { GeoJSONLayer };\nexport default withMap(GeoJSONLayer);\n//# sourceMappingURL=geojson-layer.js.map"]},"metadata":{},"sourceType":"module"}