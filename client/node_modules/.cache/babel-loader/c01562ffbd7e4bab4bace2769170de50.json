{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport * as React from 'react';\nimport { withMap } from './context';\n\nvar Source = function (_super) {\n  __extends(Source, _super);\n\n  function Source() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.id = _this.props.id;\n\n    _this.onStyleDataChange = function () {\n      if (!_this.props.map.getLayer(_this.id)) {\n        _this.initialize();\n\n        _this.forceUpdate();\n      }\n    };\n\n    _this.initialize = function () {\n      var map = _this.props.map;\n      var _a = _this.props,\n          geoJsonSource = _a.geoJsonSource,\n          tileJsonSource = _a.tileJsonSource,\n          onSourceAdded = _a.onSourceAdded;\n\n      if (!map.getSource(_this.id) && (geoJsonSource || tileJsonSource)) {\n        if (geoJsonSource) {\n          map.addSource(_this.id, geoJsonSource);\n        } else if (tileJsonSource) {\n          map.addSource(_this.id, tileJsonSource);\n        }\n\n        map.on('sourcedata', _this.onData);\n\n        if (onSourceAdded) {\n          onSourceAdded(map.getSource(_this.id));\n        }\n      }\n    };\n\n    _this.onData = function () {\n      var map = _this.props.map;\n      var source = map.getSource(_this.props.id);\n\n      if (!source || !map.isSourceLoaded(_this.props.id)) {\n        return;\n      }\n\n      var onSourceLoaded = _this.props.onSourceLoaded;\n\n      if (source && onSourceLoaded) {\n        onSourceLoaded(source);\n      }\n\n      if (source && _this.props.geoJsonSource && _this.props.geoJsonSource.data) {\n        source.setData(_this.props.geoJsonSource.data);\n      }\n\n      map.off('sourcedata', _this.onData);\n    };\n\n    return _this;\n  }\n\n  Source.prototype.componentDidMount = function () {\n    var map = this.props.map;\n    map.on('styledata', this.onStyleDataChange);\n    this.initialize();\n  };\n\n  Source.prototype.removeSource = function () {\n    var _this = this;\n\n    var map = this.props.map;\n\n    if (map.getSource(this.id)) {\n      var _a = map.getStyle().layers,\n          layers_1 = _a === void 0 ? [] : _a;\n      layers_1 = layers_1.map(function (layer, idx) {\n        var before = (layers_1[idx + 1] || {\n          id: undefined\n        }).id;\n        return __assign({}, layer, {\n          before: before\n        });\n      }).filter(function (layer) {\n        return layer.source === _this.id;\n      });\n      layers_1.forEach(function (layer) {\n        return map.removeLayer(layer.id);\n      });\n      map.removeSource(this.id);\n      return layers_1.reverse();\n    }\n\n    return [];\n  };\n\n  Source.prototype.componentWillUnmount = function () {\n    var map = this.props.map;\n\n    if (!map || !map.getStyle()) {\n      return;\n    }\n\n    map.off('styledata', this.onStyleDataChange);\n    this.removeSource();\n  };\n\n  Source.prototype.componentDidUpdate = function (prevProps) {\n    var geoJsonSource = prevProps.geoJsonSource,\n        tileJsonSource = prevProps.tileJsonSource,\n        map = prevProps.map;\n    var source = map.getSource(this.id);\n\n    if (tileJsonSource && this.props.tileJsonSource) {\n      var urlUpdated = false;\n      var tilesUpdated = false;\n\n      if (source && source.type === 'vector') {\n        var hasNewSourceUrl = tileJsonSource.url !== this.props.tileJsonSource.url;\n\n        if (hasNewSourceUrl && this.props.tileJsonSource.url !== undefined) {\n          source.setUrl(this.props.tileJsonSource.url);\n          urlUpdated = true;\n        }\n\n        var hasNewSourceTiles = tileJsonSource.tiles !== this.props.tileJsonSource.tiles;\n\n        if (hasNewSourceTiles && this.props.tileJsonSource.tiles !== undefined) {\n          source.setTiles(this.props.tileJsonSource.tiles);\n          tilesUpdated = true;\n        }\n      }\n\n      var hasNewTilesSource = !urlUpdated && tileJsonSource.url !== this.props.tileJsonSource.url || !tilesUpdated && tileJsonSource.tiles !== this.props.tileJsonSource.tiles || tileJsonSource.minzoom !== this.props.tileJsonSource.minzoom || tileJsonSource.maxzoom !== this.props.tileJsonSource.maxzoom;\n\n      if (hasNewTilesSource) {\n        var layers = this.removeSource();\n        map.addSource(this.id, this.props.tileJsonSource);\n        layers.forEach(function (layer) {\n          return map.addLayer(layer, layer.before);\n        });\n      }\n    }\n\n    if (geoJsonSource && this.props.geoJsonSource && this.props.geoJsonSource.data !== geoJsonSource.data && this.props.geoJsonSource.data && source && source.type === 'geojson') {\n      source.setData(this.props.geoJsonSource.data);\n    }\n  };\n\n  Source.prototype.render = function () {\n    return null;\n  };\n\n  return Source;\n}(React.Component);\n\nexport { Source };\nexport default withMap(Source);","map":{"version":3,"sources":["../src/source.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport * as React from 'react';\nimport { withMap } from './context';\nvar Source = (function (_super) {\n    __extends(Source, _super);\n    function Source() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.id = _this.props.id;\n        _this.onStyleDataChange = function () {\n            if (!_this.props.map.getLayer(_this.id)) {\n                _this.initialize();\n                _this.forceUpdate();\n            }\n        };\n        _this.initialize = function () {\n            var map = _this.props.map;\n            var _a = _this.props, geoJsonSource = _a.geoJsonSource, tileJsonSource = _a.tileJsonSource, onSourceAdded = _a.onSourceAdded;\n            if (!map.getSource(_this.id) && (geoJsonSource || tileJsonSource)) {\n                if (geoJsonSource) {\n                    map.addSource(_this.id, geoJsonSource);\n                }\n                else if (tileJsonSource) {\n                    map.addSource(_this.id, tileJsonSource);\n                }\n                map.on('sourcedata', _this.onData);\n                if (onSourceAdded) {\n                    onSourceAdded(map.getSource(_this.id));\n                }\n            }\n        };\n        _this.onData = function () {\n            var map = _this.props.map;\n            var source = map.getSource(_this.props.id);\n            if (!source || !map.isSourceLoaded(_this.props.id)) {\n                return;\n            }\n            var onSourceLoaded = _this.props.onSourceLoaded;\n            if (source && onSourceLoaded) {\n                onSourceLoaded(source);\n            }\n            if (source && _this.props.geoJsonSource && _this.props.geoJsonSource.data) {\n                source.setData(_this.props.geoJsonSource.data);\n            }\n            map.off('sourcedata', _this.onData);\n        };\n        return _this;\n    }\n    Source.prototype.componentDidMount = function () {\n        var map = this.props.map;\n        map.on('styledata', this.onStyleDataChange);\n        this.initialize();\n    };\n    Source.prototype.removeSource = function () {\n        var _this = this;\n        var map = this.props.map;\n        if (map.getSource(this.id)) {\n            var _a = map.getStyle().layers, layers_1 = _a === void 0 ? [] : _a;\n            layers_1 = layers_1\n                .map(function (layer, idx) {\n                var before = (layers_1[idx + 1] || { id: undefined }).id;\n                return __assign({}, layer, { before: before });\n            })\n                .filter(function (layer) { return layer.source === _this.id; });\n            layers_1.forEach(function (layer) { return map.removeLayer(layer.id); });\n            map.removeSource(this.id);\n            return layers_1.reverse();\n        }\n        return [];\n    };\n    Source.prototype.componentWillUnmount = function () {\n        var map = this.props.map;\n        if (!map || !map.getStyle()) {\n            return;\n        }\n        map.off('styledata', this.onStyleDataChange);\n        this.removeSource();\n    };\n    Source.prototype.componentDidUpdate = function (prevProps) {\n        var geoJsonSource = prevProps.geoJsonSource, tileJsonSource = prevProps.tileJsonSource, map = prevProps.map;\n        var source = map.getSource(this.id);\n        if (tileJsonSource && this.props.tileJsonSource) {\n            var urlUpdated = false;\n            var tilesUpdated = false;\n            if (source && source.type === 'vector') {\n                var hasNewSourceUrl = tileJsonSource.url !== this.props.tileJsonSource.url;\n                if (hasNewSourceUrl && this.props.tileJsonSource.url !== undefined) {\n                    source.setUrl(this.props.tileJsonSource.url);\n                    urlUpdated = true;\n                }\n                var hasNewSourceTiles = tileJsonSource.tiles !== this.props.tileJsonSource.tiles;\n                if (hasNewSourceTiles &&\n                    this.props.tileJsonSource.tiles !== undefined) {\n                    source.setTiles(this.props.tileJsonSource.tiles);\n                    tilesUpdated = true;\n                }\n            }\n            var hasNewTilesSource = (!urlUpdated && tileJsonSource.url !== this.props.tileJsonSource.url) ||\n                (!tilesUpdated &&\n                    tileJsonSource.tiles !== this.props.tileJsonSource.tiles) ||\n                tileJsonSource.minzoom !== this.props.tileJsonSource.minzoom ||\n                tileJsonSource.maxzoom !== this.props.tileJsonSource.maxzoom;\n            if (hasNewTilesSource) {\n                var layers = this.removeSource();\n                map.addSource(this.id, this.props.tileJsonSource);\n                layers.forEach(function (layer) { return map.addLayer(layer, layer.before); });\n            }\n        }\n        if (geoJsonSource &&\n            this.props.geoJsonSource &&\n            this.props.geoJsonSource.data !== geoJsonSource.data &&\n            this.props.geoJsonSource.data &&\n            source &&\n            source.type === 'geojson') {\n            source.setData(this.props.geoJsonSource.data);\n        }\n    };\n    Source.prototype.render = function () {\n        return null;\n    };\n    return Source;\n}(React.Component));\nexport { Source };\nexport default withMap(Source);\n//# sourceMappingURL=source.js.map"]},"metadata":{},"sourceType":"module"}